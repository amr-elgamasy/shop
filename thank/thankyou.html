<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ | Ù…ØªØ¬Ø±Ù†Ø§</title>
  <link rel="stylesheet" href="thank.css">
</head>
<body>
  <div class="thank-you-container">
    <div class="thank-you-card">
      <div id="loading" style="display: none;" class="loading-indicator">
        <div class="spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø¨Ùƒ...</p>
      </div>

      <div id="success-content">
        <div class="checkmark-circle">
          <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
            <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
            <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
          </svg>
        </div>
        
        <h1>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ!</h1>
        <p class="thank-you-message">
          Ù„Ù‚Ø¯ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ³ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ²Ù‡ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†. 
          <br>Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø±Ø³Ø§Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø­Ù† ÙˆØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ.
        </p>
        
        <div class="order-details">
          <div class="detail-row">
            <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
            <span class="detail-value">#<span id="order-number">--</span></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨:</span>
            <span class="detail-value" id="order-date">--</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span>
            <span class="detail-value" id="payment-method">--</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
            <span class="detail-value total-amount" id="total-amount">--</span>
          </div>
        </div>
        
        <div class="whats-next">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©ØŸ
          </h2>
          <ul class="next-steps">
            <li>Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ùƒ ÙˆØªØ¬Ù‡ÙŠØ²Ù‡ Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø©</li>
            <li>Ø³ØªØªÙ„Ù‚Ù‰ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø´Ø­Ù† Ø§Ù„Ø·Ù„Ø¨</li>
            <li>ÙŠÙ…ÙƒÙ†Ùƒ ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±ÙÙ‚ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</li>
            <li>Ø³ÙŠØªÙ… ØªÙˆØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø®Ù„Ø§Ù„ 2-5 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„</li>
          </ul>
        </div>
        
        <div class="action-buttons">
          <!-- Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨ -->
          <button onclick="printOrder()" class="btn btn-primary" style="background: var(--success-color)">
            <i class="fas fa-print" style="margin-left: 8px;"></i>
            Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨
          </button>

          <!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ -->
          <a href="https://wa.me/966500000000" class="btn btn-whatsapp">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 8px;">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
            ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
          </a>
          <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚ -->
          <a href="../product/products.html" class="btn btn-outline" style="margin-top: 10px; width: 100%;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 8px;">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³ÙˆÙ‚
          </a>
        </div>
        
        <div class="contact-info">
          Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªØŒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ <a href="mailto:support@example.com">Ù…Ø±Ø§Ø³Ù„ØªÙ†Ø§ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</a> 
          Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ <a href="tel:+966500000000">Ù Ù¥Ù Ù Ù Ù Ù Ù Ù Ù </a>
        </div>
      </div>

      <div id="error-message" style="display: none;" class="error-message">
        <p id="error-text">Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§.</p>
      </div>
    </div>
  </div>

  <!-- Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© -->
  <style>
    /* ØªÙ†Ø³ÙŠÙ‚ ØµÙØ­Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    @media print {
      body * {
        visibility: hidden;
      }
      .thank-you-card, .thank-you-card * {
        visibility: visible;
      }
      .thank-you-card {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .action-buttons, .whats-next {
        display: none !important;
      }
      .order-details {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 20px 0;
      }
    }

    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
    .thank-you-card {
      position: relative;
      overflow: hidden;
    }

    .thank-you-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent 0%,
        rgba(50, 173, 150, 0.05) 30%,
        transparent 60%
      );
      animation: shimmer 4s infinite linear;
      z-index: -1;
    }

    @keyframes shimmer {
      0% { transform: translateX(-30%) translateY(-30%) rotate(0deg); }
      100% { transform: translateX(-30%) translateY(-30%) rotate(360deg); }
    }

    .btn-whatsapp {
      background: #25D366;
      color: white;
      border: none;
      width: 100%;
      margin-top: 10px;
    }

    .btn-whatsapp:hover {
      background: #128C7E;
    }

    .order-details {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px dashed rgba(0,0,0,0.1);
    }

    .detail-row:last-child {
      border-bottom: none;
    }
    .loading-indicator {
      text-align: center;
      margin: 20px 0;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      margin: 0 auto 15px;
      animation: spin 1s linear infinite;
    }

    .error-message {
      background-color: #fff5f5;
      color: #e53e3e;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: center;
      border: 1px solid #fed7d7;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script>
    // Ø¯Ø§Ù„Ø© Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨
    function printOrder() {
      window.print();
    }
    // ØªØ¹Ø±ÙŠÙ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹
    const paymentMethods = {
      'cash': 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',
      'wallet': 'Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©',
      'visa': 'Ø¨Ø·Ø§Ù‚Ø© ÙÙŠØ²Ø§ / Ù…Ø§Ø³ØªØ±ÙƒØ§Ø±Ø¯'
    };

    document.addEventListener('DOMContentLoaded', function () {
      const loading = document.getElementById('loading');
      const successContent = document.getElementById('success-content');
      const errorMessage = document.getElementById('error-message');
      const errorText = document.getElementById('error-text');

      async function processOrder() {
        try {
          loading.style.display = 'block';
          successContent.style.display = 'none';
          errorMessage.style.display = 'none';

          const orderNumber = localStorage.getItem("order_number");
          const orderData = JSON.parse(localStorage.getItem("checkout_data") || "{}");
          
          if (!orderData || !orderNumber) {
            throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
          }

          // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„
          const timestamp = new Date().toLocaleString('ar-EG', {
            year: 'numeric',
            month: 'numeric',
            day: 'numeric',
            hour: 'numeric',
            minute: 'numeric',
            hour12: true
          });

          // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø´ÙŠØª
          const serverData = {
            action: 'checkAndUpdateQuantity',
            contents: {
              order: {
                number: orderNumber,
                timestamp: timestamp,
                customer_name: orderData.name,
                phone: orderData.phone,
                address: orderData.address,
                payment_method: orderData.payment_method,
                products: JSON.stringify(orderData.products),
                total_amount: orderData.total_amount,
                notes: orderData.notes || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'
              },
              products: orderData.products.map(item => ({
                id: item.id,
                quantity: item.quantity
              }))
            }
          };

          // ØªØ³Ø¬ÙŠÙ„ Ø£ÙƒØ«Ø± ØªÙØµÙŠÙ„Ø§Ù‹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          console.log('=== Ø¨Ø¯Ø§ÙŠØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨ ===');
          console.log('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨:', orderData);
          console.log('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ø³ÙŠØ±ÙØ±:', serverData);
          console.log('Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:', paymentMethods[orderData.payment_method]);

          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø´ÙŠØª
          const formData = new URLSearchParams();
          formData.append('data', JSON.stringify(serverData));

          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
          const sheetResponse = await fetch('https://script.google.com/macros/s/AKfycbx25K95DTNH7oziuub4qGxMY6boKEiJrkJFoVSH2R464NSdC025KoiL8qdUiAPoLEwM/exec', {
            method: 'POST',
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: formData.toString()
          });

          // ØªØ¬Ù‡ÙŠØ² Ø±Ø³Ø§Ù„Ø© ØªÙ„ÙŠØ¬Ø±Ø§Ù…
          const productsText = orderData.products.map(item =>
            `Ø§Ù„Ù…Ù†ØªØ¬: ${item.name}\nØ§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}\nØ§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬.Ù…`
          ).join('\n\n');

          // ØªØ­ÙˆÙŠÙ„ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©

          const message = `ğŸ›ï¸ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯!\n\n` +
            `Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${orderNumber}\n` +
            `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${timestamp}\n\n` +
            `ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:\n` +
            `Ø§Ù„Ø§Ø³Ù…: ${orderData.name}\n` +
            `Ø§Ù„Ù‡Ø§ØªÙ: ${orderData.phone}\n` +
            `Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${orderData.address}\n\n` +
            `ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n${productsText}\n\n` +
            `ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${orderData.total_amount} Ø¬.Ù…\n` +
            `ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentMethods[orderData.payment_method] || orderData.payment_method}\n` +
            `ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${orderData.notes || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'}`;

          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…
          const telegramResponse = await fetch(`https://api.telegram.org/bot7640824940:AAFZyK7kuzFa5CJSJzvte6xhe_ATBFw53G4/sendMessage`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              chat_id: '5773416612',
              text: message,
              parse_mode: 'HTML'
            })
          });

          if (!telegramResponse.ok) {
            console.error('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù…');
          } else {
            console.log('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
          }
          
          console.log('=== Ù†Ù‡Ø§ÙŠØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨ ===');

          // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
          document.getElementById('order-number').textContent = orderNumber;
          document.getElementById('order-date').textContent = timestamp;

          // ØªÙ… Ù†Ù‚Ù„ ØªØ¹Ø±ÙŠÙ paymentMethods Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ù‰
          document.getElementById('payment-method').textContent = paymentMethods[orderData.payment_method] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
          document.getElementById('total-amount').textContent = orderData.total_amount.toLocaleString('ar-EG') + ' Ø¬.Ù…';

          // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
          loading.style.display = 'none';
          successContent.style.display = 'block';
          
          console.log('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');

          // ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ù„Ø¥ÙØ±Ø§Øº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
          localStorage.setItem('should_reset_form', 'true');

          // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
          localStorage.removeItem("checkout_data");
          localStorage.removeItem("cart");
          localStorage.removeItem("order_number");

        } catch (error) {
          console.error("ğŸš¨ Ø®Ø·Ø£:", error);
          loading.style.display = 'none';
          successContent.style.display = 'none';
          errorMessage.style.display = 'block';
          errorText.textContent = 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ: ' + error.message;
        }
      }

      // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨
      processOrder();
    });
  </script>
</body>
</html>